<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="doctg.xsl" ?>
<testgroup 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="http://www.openscdp.org/schema/testframework-1.0.xsd"
	id="tg_case_4" arrayElement="testcase,function" arrayIndex="id,Name">
	<name>CASE 4 APDUs</name>
	<description>
		<p>
			This testgroup checks the functionality of the applet using case 4 APDUs.
			
		</p>
	</description>
	<reference>
		<p></p>
	</reference>

<!-- Initializing the test group environment -->

	<constructor Param="name, parameter">
		<Script><![CDATA[
			TestGroup.call(this, name, parameter);
		]]></Script>
	</constructor>


	
<!-- Setup method called before each test case is executed -->
	<setup>
		<Script><![CDATA[
			var aid = new ByteString("E82B0601040181C31F0202", HEX);

			this.card = new Card(_scsh3.reader);
			this.card.reset(Card.RESET_COLD);

			// Select application
			var rsp = this.card.sendApdu(0x00, 0xA4, 0x04, 0x04, aid, 0x00, [0x9000]);
			print(new ASN1(rsp));
			
		]]></Script>
	</setup>


	
<!-- Teardown method called after each test case is executed -->
	<teardown>
		<Script><![CDATA[	
		]]></Script>
	</teardown>

	
	
	<testcase id="001.CASE4.SHORT">
		<name>Case 4 Short APDU</name>
		<description>
			<p>.</p>
		</description>
		<requirement>
			<p></p>
		</requirement>
		<reference>
			<p></p>
		</reference>
		<Script><![CDATA[
			
			var crypto = new Crypto();
			
			// Case 4 short - send 255 bytes, request 250 bytes
			var data = crypto.generateRandom(255);
			var rsp = this.card.sendApdu(0x00, 0xF4, 0x00, 0xFA, data, 0x00, [0x9000]);
			assert(rsp.length == 250);
			
			var infoBlock = this.card.sendApdu(0x00, 0xF0, 0x00, 0x00, 0x00, [0x9000]);
			print(infoBlock);
				
			]]></Script>
	</testcase>	
	
	
	
	<testcase id="002.CASE4.EXTENDED">
		<name>Case 4 Extended APDU</name>
		<description>
			<p>.</p>
		</description>
		<requirement>
			<p></p>
		</requirement>
		<reference>
			<p></p>
		</reference>
		<Script><![CDATA[
			
			var crypto = new Crypto();			
			
			// Case 4 extended - send 4096 bytes, request 4096 bytes
			var data = crypto.generateRandom(4096);
			var rsp = this.card.sendApdu(0x00, 0xF4, 0x10, 0x00, data, 65536, [0x9000]);
			assert(rsp.length == 4096);

			var infoBlock = this.card.sendApdu(0x00, 0xF0, 0x00, 0x00, 0x00, [0x9000]);
			print(infoBlock);
				
			]]></Script>
	</testcase>	
	
	
	
	<testcase id="003.CASE4.EXCEPTIONS">
		<name>Case 4 APDU Exeptions</name>
		<description>
			<p>.</p>
		</description>
		<requirement>
			<p></p>
		</requirement>
		<reference>
			<p></p>
		</reference>
		<Script><![CDATA[
			
			var crypto = new Crypto();
			
			var data = crypto.generateRandom(255);			
			var rsp = this.card.sendApdu(0x00, 0xF4, 0x00, 0xFA, data, [0x6700]);
			
			var data = crypto.generateRandom(255);
			var rsp = this.card.sendApdu(0x00, 0xF4, 0x00, 0xFA, 0x00, [0x6700]);
			
			var data = crypto.generateRandom(255);
			var rsp = this.card.sendApdu(0x00, 0xF4, 0x00, 0x00, data, 0x20, [0x6282]);
				
			]]></Script>
	</testcase>
	
</testgroup>
